/**
 * @file LS_Battery.h
 * @brief Polls battery voltage
 *
 * @date 9/13/2024
 *
 **/
#include "LS_Battery.h"
#include <LS_Motor_DRV8823.h>
////////////////////////////////////////////////////////////////////////////////
///
///                           Internal Constants
///
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
///
///                           Internal Macros
///
////////////////////////////////////////////////////////////////////////////////
#define NUM_BAT_SAMPLES 		10
#define BATTERY_TASK_SLEEP_TIME	1000
////////////////////////////////////////////////////////////////////////////////
////
///
///                           Internal Types
///
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
///
///                           Internal Data
///
////////////////////////////////////////////////////////////////////////////////
uint8_t batPercent = 0;
osThreadId_t batteryTaskHandle;
const osThreadAttr_t batteryTask_attributes = {
  .name = "batteryTask",
  .priority = (osPriority_t) osPriorityBelowNormal,
  .stack_size = 128 * 4
};
////////////////////////////////////////////////////////////////////////////////
///
///                           Internal Functions
///
////////////////////////////////////////////////////////////////////////////////
///
/// @brief  Function implementing the battery task.
///
/// @param  argument: Hardcoded to 0.
///
/// @return void
///
static void BatteryTask(void * argument) {

	//SetMux(BATTERY);
    for (;;) {
    	//
    	// Alternate measuring between battery voltage and hall effect
    	//
		//HAL_ADC_Start_IT(&hadc1);
        osDelay(BATTERY_TASK_SLEEP_TIME);
    }
}
//------------------------------------------------------------------------------
//
//                           Callback Handlers
//
//------------------------------------------------------------------------------
////////////////////////////////////////////////////////////////////////////////
///
///                           External Functions
///
///////////////////////////////////////////////////////////////////////////////
uint8_t LS_Battery_GetBatteryVoltage() {
	return batPercent;
}
void LS_Battery_Init() {
	//
	// Create the battery task
	//
	batteryTaskHandle = osThreadNew(BatteryTask, NULL, &batteryTask_attributes);

}
////////////////////////////////////////////////////////////////////////////////
///
///                              Global Data
///
////////////////////////////////////////////////////////////////////////////////


